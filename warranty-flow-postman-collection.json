{
	"info": {
		"_postman_id": "warranty-flow-collection-v2",
		"name": "EV Warranty Management - Corrected Flow",
		"description": "Corrected warranty registration and claim flow testing based on actual project structure",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{jwt_token}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"if (!pm.collectionVariables.get('base_url')) {",
					"    pm.collectionVariables.set('base_url', 'http://localhost:8080');",
					"}"
				]
			}
		}
	],
	"item": [
		{
			"name": "1. Authentication Flow",
			"item": [
				{
					"name": "1.1 Register SC Staff User",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"const timestamp = Date.now();",
									"pm.collectionVariables.set('staff_username', 'sc_technician_' + timestamp);",
									"pm.collectionVariables.set('staff_email', 'sc_technician_' + timestamp + '@warranty.com');",
									"pm.collectionVariables.set('staff_password', 'TechPass123!');",
									"pm.collectionVariables.set('staff_fullname', 'SC Technician User ' + timestamp);",
									"pm.collectionVariables.set('staff_phone', '0987654' + (timestamp % 1000));"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Response has token', function () {",
									"    if (pm.response.text() && pm.response.text().trim() !== '') {",
									"        try {",
									"            const responseJson = pm.response.json();",
									"            pm.expect(responseJson).to.have.property('token');",
									"            pm.collectionVariables.set('jwt_token', responseJson.token);",
									"            if (responseJson.userId) {",
									"                pm.collectionVariables.set('staff_user_id', responseJson.userId);",
									"            }",
									"        } catch (e) {",
									"            console.log('Response parsing error:', e.message);",
									"            console.log('Response text:', pm.response.text());",
									"        }",
									"    }",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"{{staff_username}}\",\n    \"email\": \"{{staff_email}}\",\n    \"password\": \"{{staff_password}}\",\n    \"fullname\": \"{{staff_fullname}}\",\n    \"phone\": \"{{staff_phone}}\",\n    \"role\": \"SC_TECHNICIAN\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"register"
							]
						}
					}
				},
				{
					"name": "1.2 Login SC Staff",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Login successful with token', function () {",
									"    if (pm.response.text() && pm.response.text().trim() !== '') {",
									"        try {",
									"            const responseJson = pm.response.json();",
									"            pm.expect(responseJson).to.have.property('token');",
									"            pm.collectionVariables.set('jwt_token', responseJson.token);",
									"        } catch (e) {",
									"            console.log('Login response parsing error:', e.message);",
									"        }",
									"    }",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"{{staff_username}}\",\n    \"password\": \"{{staff_password}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"login"
							]
						}
					}
				}
			]
		},
		{
			"name": "2. Vehicle Registration Flow",
			"item": [
				{
					"name": "2.1 Register Vehicle with New Customer",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"const timestamp = Date.now();",
									"const vinSuffix = (timestamp % 100000).toString().padStart(5, '0');",
									"pm.collectionVariables.set('vehicle_vin', '1HGBH41JXMN' + vinSuffix);",
									"pm.collectionVariables.set('vehicle_model', 'Tesla Model Y');",
									"pm.collectionVariables.set('vehicle_year', 2024);",
									"pm.collectionVariables.set('vehicle_mileage', Math.floor(Math.random() * 5000));",
									"",
									"const today = new Date().toISOString().split('T')[0];",
									"pm.collectionVariables.set('registration_date', today);",
									"pm.collectionVariables.set('warranty_start', today);",
									"",
									"const now = new Date().toISOString();",
									"pm.collectionVariables.set('installation_datetime', now);",
									"",
									"pm.collectionVariables.set('customer_phone', '0901234' + (timestamp % 1000));",
									"pm.collectionVariables.set('customer_name', 'Nguyen Van Test ' + timestamp);",
									"pm.collectionVariables.set('customer_email', 'customer_' + timestamp + '@gmail.com');",
									"pm.collectionVariables.set('customer_address', '123 Test Street, HCM City');",
									"",
									"pm.collectionVariables.set('battery_serial', 'BATT_' + timestamp);",
									"pm.collectionVariables.set('motor_serial', 'MOTOR_' + timestamp);",
									"pm.collectionVariables.set('inverter_serial', 'INV_' + timestamp);"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Vehicle registered successfully', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('id');",
									"    pm.expect(responseJson).to.have.property('vin');",
									"    pm.expect(responseJson.vin).to.eql(pm.collectionVariables.get('vehicle_vin'));",
									"    ",
									"    pm.collectionVariables.set('vehicle_id', responseJson.id);",
									"    if (responseJson.customer && responseJson.customer.id) {",
									"        pm.collectionVariables.set('customer_id', responseJson.customer.id);",
									"    }",
									"});",
									"",
									"console.log('Vehicle registered:', pm.collectionVariables.get('vehicle_id'));",
									"console.log('Customer ID:', pm.collectionVariables.get('customer_id'));"
								]
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"vin\": \"{{vehicle_vin}}\",\n    \"model\": \"{{vehicle_model}}\",\n    \"year\": {{vehicle_year}},\n    \"mileageKm\": {{vehicle_mileage}},\n    \"customerInfo\": {\n        \"name\": \"{{customer_name}}\",\n        \"phone\": \"{{customer_phone}}\",\n        \"email\": \"{{customer_email}}\",\n        \"address\": \"{{customer_address}}\"\n    },\n    \"registrationDate\": \"{{registration_date}}\",\n    \"warrantyStart\": \"{{warranty_start}}\",\n    \"installedParts\": [\n        {\n            \"partId\": 1,\n            \"serialNumber\": \"{{battery_serial}}\",\n            \"manufactureDate\": \"{{registration_date}}\",\n            \"installedAt\": \"{{installation_datetime}}\"\n        },\n        {\n            \"partId\": 2,\n            \"serialNumber\": \"{{motor_serial}}\",\n            \"manufactureDate\": \"{{registration_date}}\",\n            \"installedAt\": \"{{installation_datetime}}\"\n        },\n        {\n            \"partId\": 3,\n            \"serialNumber\": \"{{inverter_serial}}\",\n            \"manufactureDate\": \"{{registration_date}}\",\n            \"installedAt\": \"{{installation_datetime}}\"\n        }\n    ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/vehicles/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"vehicles",
								"register"
							]
						}
					}
				},
				{
					"name": "2.2 Verify Vehicle Registration",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Vehicle details correct', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.vin).to.eql(pm.collectionVariables.get('vehicle_vin'));",
									"    pm.expect(responseJson.model).to.eql(pm.collectionVariables.get('vehicle_model'));",
									"});"
								]
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/vehicles/vin/{{vehicle_vin}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"vehicles",
								"vin",
								"{{vehicle_vin}}"
							]
						}
					}
				},
				{
					"name": "2.3 Get Vehicle by ID",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Vehicle retrieved by ID', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('id');",
									"    pm.expect(responseJson.id).to.eql(parseInt(pm.collectionVariables.get('vehicle_id')));",
									"});"
								]
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/vehicles/{{vehicle_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"vehicles",
								"{{vehicle_id}}"
							]
						}
					}
				},
				{
					"name": "2.4 Get Vehicles by Customer",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"const customerId = pm.collectionVariables.get('customer_id');",
									"if (!customerId) {",
									"    console.log('No customer ID available, skipping request');",
									"    pm.execution.skipRequest();",
									"}"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Vehicles list returned', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.be.an('array');",
									"    if (responseJson.length > 0) {",
									"        pm.expect(responseJson[0]).to.have.property('vin');",
									"    }",
									"});"
								]
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/vehicles/customer/{{customer_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"vehicles",
								"customer",
								"{{customer_id}}"
							]
						}
					}
				}
			]
		},
		{
			"name": "3. Customer Management Tests",
			"item": [
				{
					"name": "3.1 Search Customer by Phone",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Customer search completed', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const responseJson = pm.response.json();",
									"    console.log('Customer found:', responseJson);",
									"}"
								]
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/customers/search?phone={{customer_phone}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"customers",
								"search"
							],
							"query": [
								{
									"key": "phone",
									"value": "{{customer_phone}}"
								}
							]
						}
					}
				},
				{
					"name": "3.2 Get Customer by ID",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"const customerId = pm.collectionVariables.get('customer_id');",
									"if (!customerId) {",
									"    console.log('No customer ID available, skipping request');",
									"    pm.execution.skipRequest();",
									"}"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Customer details retrieved', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('id');",
									"    pm.expect(responseJson.id).to.eql(parseInt(pm.collectionVariables.get('customer_id')));",
									"});"
								]
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/customers/{{customer_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"customers",
								"{{customer_id}}"
							]
						}
					}
				}
			]
		},
		{
			"name": "5. Warranty Claim Flow Tests",
			"item": [
				{
					"name": "5.1 Intake-first Flow",
					"item": [
						{
							"name": "5.1.1 Create Complete Claim (Intake Flow)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"type": "text/javascript",
										"exec": [
											"const timestamp = Date.now();",
											"pm.collectionVariables.set('claim_title', 'Battery Performance Issue - ' + timestamp);",
											"pm.collectionVariables.set('claim_description', 'Customer reports reduced battery capacity and unusual charging behavior. Battery shows 70% capacity after 6 months of use.');",
											"",
											"// Set appointment date (tomorrow)",
											"const tomorrow = new Date();",
											"tomorrow.setDate(tomorrow.getDate() + 1);",
											"pm.collectionVariables.set('appointment_date', tomorrow.toISOString());",
											"",
											"// Set diagnostic data",
											"pm.collectionVariables.set('diagnostic_summary', 'Battery capacity test shows 72% of original capacity. Cell imbalance detected.');",
											"pm.collectionVariables.set('diagnostic_data', JSON.stringify({",
											"    errorCodes: ['P0A80', 'P0AA6'],",
											"    bmsReadings: { voltage: 385.2, current: -15.8, temperature: 32.1 },",
											"    cellVoltages: [3.85, 3.87, 3.83, 3.86, 3.84, 3.88]",
											"}));",
											"pm.collectionVariables.set('test_results', 'Voltage: 385.2V, Current: -15.8A, Temp: 32.1¬∞C, Cell imbalance: 50mV');",
											"pm.collectionVariables.set('repair_notes', 'Battery pack requires replacement due to premature capacity loss and cell imbalance.');",
											"pm.collectionVariables.set('labor_hours', 4.5);"
										]
									}
								},
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 201', function () {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"pm.test('Claim created successfully (Intake)', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('id');",
											"    pm.expect(responseJson).to.have.property('claimNumber');",
											"    pm.expect(responseJson).to.have.property('status');",
											"    pm.expect(responseJson).to.have.property('vehicle');",
											"    pm.expect(responseJson.vehicle).to.have.property('vin');",
											"    pm.expect(responseJson.vehicle.vin).to.eql(pm.collectionVariables.get('vehicle_vin'));",
											"    ",
											"    pm.collectionVariables.set('intake_claim_id', responseJson.id);",
											"    pm.collectionVariables.set('intake_claim_number', responseJson.claimNumber);",
											"    ",
											"    console.log('Intake Claim Created:', responseJson.claimNumber);",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"customerName\": \"{{customer_name}}\",\n    \"customerPhone\": \"{{customer_phone}}\",\n    \"customerEmail\": \"{{customer_email}}\",\n    \"customerAddress\": \"{{customer_address}}\",\n    \"vin\": \"{{vehicle_vin}}\",\n    \"mileageKm\": {{vehicle_mileage}},\n    \"claimTitle\": \"{{claim_title}}\",\n    \"reportedFailure\": \"{{claim_description}}\",\n    \"appointmentDate\": \"{{appointment_date}}\",\n    \"customerConsent\": true\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/claims/intake",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"intake"
									]
								}
							}
						},
						{
							"name": "5.1.2 Add Diagnostic to Intake Claim",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Diagnostic added successfully', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('diagnosticSummary');",
											"    pm.expect(responseJson.diagnosticSummary).to.include('Battery capacity');",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"diagnosticSummary\": \"{{diagnostic_summary}}\",\n    \"diagnosticData\": \"{{diagnostic_data}}\",\n    \"testResults\": \"{{test_results}}\",\n    \"repairNotes\": \"{{repair_notes}}\",\n    \"laborHours\": {{labor_hours}},\n    \"partsUsed\": [\n        {\n            \"partId\": 1,\n            \"quantity\": 1,\n            \"notes\": \"Battery pack replacement\"\n        }\n    ],\n    \"initialDiagnosis\": \"Battery capacity degradation\",\n    \"readyForSubmission\": true\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/claims/{{intake_claim_id}}/diagnostic",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"{{intake_claim_id}}",
										"diagnostic"
									]
								}
							}
						},
						{
							"name": "5.1.3 Mark Intake Claim Ready for Submission",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Claim marked ready for submission', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('canSubmitToEvm');",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/claims/{{intake_claim_id}}/ready",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"{{intake_claim_id}}",
										"ready"
									]
								}
							}
						},
						{
							"name": "5.1.4 Validate Intake Claim",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Claim validation result', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('canSubmitToEvm');",
											"    ",
											"    if (responseJson.canSubmitToEvm) {",
											"        console.log('‚úÖ Intake claim is ready for EVM submission');",
											"    } else {",
											"        console.log('‚ùå Intake claim missing requirements:', responseJson.missingRequirements);",
											"    }",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/claims/{{intake_claim_id}}/validate",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"{{intake_claim_id}}",
										"validate"
									]
								}
							}
						},
						{
							"name": "5.1.5 Submit Intake Claim to EVM",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Claim submitted to EVM successfully', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('status');",
											"    console.log('üöÄ Intake claim submitted to EVM:', responseJson.claimNumber);",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"claimId\": {{intake_claim_id}},\n    \"submissionNotes\": \"Battery pack replacement claim - completed intake process with full diagnostic\",\n    \"forceSubmit\": false\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/claims/submit",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"submit"
									]
								}
							}
						}
					]
				},
				{
					"name": "5.2 Collaborative Flow",
					"item": [
						{
							"name": "5.2.1 Create Draft Claim (Collaborative Flow)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"type": "text/javascript",
										"exec": [
											"const timestamp = Date.now();",
											"pm.collectionVariables.set('collab_claim_title', 'Motor Noise Investigation - ' + timestamp);",
											"pm.collectionVariables.set('collab_claim_description', 'Customer reports unusual noise from electric motor during acceleration. Requires detailed diagnostic by technician.');",
											"",
											"// Set appointment for next week",
											"const nextWeek = new Date();",
											"nextWeek.setDate(nextWeek.getDate() + 7);",
											"pm.collectionVariables.set('collab_appointment_date', nextWeek.toISOString());"
										]
									}
								},
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 201', function () {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"pm.test('Draft claim created successfully', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('id');",
											"    pm.expect(responseJson).to.have.property('claimNumber');",
											"    pm.expect(responseJson).to.have.property('status');",
											"    ",
											"    pm.collectionVariables.set('collab_claim_id', responseJson.id);",
											"    pm.collectionVariables.set('collab_claim_number', responseJson.claimNumber);",
											"    ",
											"    console.log('Draft Claim Created:', responseJson.claimNumber);",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"customerName\": \"{{customer_name}}\",\n    \"customerPhone\": \"{{customer_phone}}\",\n    \"customerEmail\": \"{{customer_email}}\",\n    \"customerAddress\": \"{{customer_address}}\",\n    \"vin\": \"{{vehicle_vin}}\",\n    \"mileageKm\": {{vehicle_mileage}},\n    \"claimTitle\": \"{{collab_claim_title}}\",\n    \"reportedFailure\": \"{{collab_claim_description}}\",\n    \"appointmentDate\": \"{{collab_appointment_date}}\",\n    \"customerConsent\": true\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/claims/draft",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"draft"
									]
								}
							}
						},
						{
							"name": "5.2.2 Technician Updates Diagnostic",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"type": "text/javascript",
										"exec": [
											"// Technician diagnostic data",
											"pm.collectionVariables.set('tech_diagnostic_summary', 'Motor bearing wear detected through vibration analysis and acoustic testing.');",
											"pm.collectionVariables.set('tech_diagnostic_data', JSON.stringify({",
											"    errorCodes: ['P0B2F', 'U0100'],",
											"    motorReadings: { rpm: 3500, torque: 285, temperature: 78.5, vibration: 12.3 },",
											"    acousticTest: { frequency: '2.4kHz', amplitude: '15dB above normal' }",
											"}));",
											"pm.collectionVariables.set('tech_test_results', 'Motor temp: 78.5¬∞C, Vibration: 12.3 m/s¬≤, Acoustic signature shows bearing wear at 2.4kHz');",
											"pm.collectionVariables.set('tech_repair_notes', 'Motor assembly requires replacement. Bearing wear beyond acceptable limits.');",
											"pm.collectionVariables.set('tech_labor_hours', 6.0);"
										]
									}
								},
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Technician diagnostic updated successfully', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('diagnosticSummary');",
											"    pm.expect(responseJson.diagnosticSummary).to.include('Motor bearing');",
											"    console.log('üîß Technician diagnostic completed');",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"diagnosticSummary\": \"{{tech_diagnostic_summary}}\",\n    \"diagnosticData\": \"{{tech_diagnostic_data}}\",\n    \"testResults\": \"{{tech_test_results}}\",\n    \"repairNotes\": \"{{tech_repair_notes}}\",\n    \"laborHours\": {{tech_labor_hours}},\n    \"partsUsed\": [\n        {\n            \"partId\": 2,\n            \"quantity\": 1,\n            \"notes\": \"Motor assembly replacement due to bearing wear\"\n        }\n    ],\n    \"initialDiagnosis\": \"Motor bearing wear\",\n    \"readyForSubmission\": true\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/claims/{{collab_claim_id}}/diagnostic",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"{{collab_claim_id}}",
										"diagnostic"
									]
								}
							}
						},
						{
							"name": "5.2.3 Mark Collaborative Claim Ready",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Collaborative claim marked ready', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('canSubmitToEvm');",
											"    console.log('‚úÖ Collaborative claim ready for submission');",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/claims/{{collab_claim_id}}/ready",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"{{collab_claim_id}}",
										"ready"
									]
								}
							}
						},
						{
							"name": "5.2.4 Submit Collaborative Claim to EVM",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Collaborative claim submitted successfully', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('status');",
											"    console.log('üöÄ Collaborative claim submitted to EVM:', responseJson.claimNumber);",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"claimId\": {{collab_claim_id}},\n    \"submissionNotes\": \"Motor replacement claim - completed collaborative workflow with technician diagnostic\",\n    \"forceSubmit\": false\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/claims/submit",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"submit"
									]
								}
							}
						}
					]
				},
				{
					"name": "5.3 Claim Management Tests",
					"item": [
						{
							"name": "5.3.1 Get Claim by ID (Intake)",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Intake claim details retrieved', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('id');",
											"    pm.expect(responseJson).to.have.property('claimNumber');",
											"    pm.expect(responseJson.id).to.eql(parseInt(pm.collectionVariables.get('intake_claim_id')));",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/claims/{{intake_claim_id}}",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"{{intake_claim_id}}"
									]
								}
							}
						},
						{
							"name": "5.3.2 Get Claim by ID (Collaborative)",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Collaborative claim details retrieved', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('id');",
											"    pm.expect(responseJson).to.have.property('claimNumber');",
											"    pm.expect(responseJson.id).to.eql(parseInt(pm.collectionVariables.get('collab_claim_id')));",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/claims/{{collab_claim_id}}",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"{{collab_claim_id}}"
									]
								}
							}
						},
						{
							"name": "5.3.3 Get Pending Approval Claims",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Pending approval claims list', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.be.an('array');",
											"    console.log('üìã Pending approval claims count:', responseJson.length);",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/claims/pending-approval",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"pending-approval"
									]
								}
							}
						},
						{
							"name": "5.3.4 Get Workflow Information",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Workflow information retrieved', function () {",
											"    const responseJson = pm.response.json();",
											"    pm.expect(responseJson).to.have.property('intakeFirstDescription');",
											"    pm.expect(responseJson).to.have.property('collaborativeDescription');",
											"    pm.expect(responseJson).to.have.property('requiredForSubmission');",
											"    ",
											"    console.log('üìã Workflow Info:');",
											"    console.log('Intake-first:', responseJson.intakeFirstDescription);",
											"    console.log('Collaborative:', responseJson.collaborativeDescription);",
											"    console.log('Requirements:', responseJson.requiredForSubmission);",
											"});"
										]
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{jwt_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/claims/workflow-info",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"claims",
										"workflow-info"
									]
								}
							}
						}
					]
				},
				{
					"name": "5.4 Warranty Claim Summary",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Warranty claim flow completed successfully', function () {",
									"    const intakeClaimId = pm.collectionVariables.get('intake_claim_id');",
									"    const collabClaimId = pm.collectionVariables.get('collab_claim_id');",
									"    const intakeClaimNumber = pm.collectionVariables.get('intake_claim_number');",
									"    const collabClaimNumber = pm.collectionVariables.get('collab_claim_number');",
									"    ",
									"    pm.expect(intakeClaimId).to.not.be.undefined;",
									"    pm.expect(collabClaimId).to.not.be.undefined;",
									"    ",
									"    console.log('');",
									"    console.log('üéâ WARRANTY CLAIM TESTING COMPLETED! üéâ');",
									"    console.log('================================================');",
									"    console.log('‚úÖ Intake-first Flow:');",
									"    console.log('   - Claim ID:', intakeClaimId);",
									"    console.log('   - Claim Number:', intakeClaimNumber);",
									"    console.log('   - Issue: Battery Performance Issue');",
									"    console.log('   - Status: Submitted to EVM');",
									"    console.log('');",
									"    console.log('‚úÖ Collaborative Flow:');",
									"    console.log('   - Claim ID:', collabClaimId);",
									"    console.log('   - Claim Number:', collabClaimNumber);",
									"    console.log('   - Issue: Motor Noise Investigation');",
									"    console.log('   - Status: Submitted to EVM');",
									"    console.log('');",
									"    console.log('üìã Both workflows tested successfully:');",
									"    console.log('   - Claim creation (intake & draft)');",
									"    console.log('   - Diagnostic updates');",
									"    console.log('   - Validation checks');",
									"    console.log('   - EVM submission');",
									"    console.log('   - Claim management operations');",
									"    console.log('================================================');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/claims/workflow-info",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"claims",
								"workflow-info"
							]
						}
					}
				}
			]
		},
		{
			"name": "4. System Validation Tests",
			"item": [
				{
					"name": "4.1 Test JWT Token Validity",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('JWT Token is valid', function () {",
									"    pm.expect(pm.response.code).to.not.eql(401);",
									"    pm.expect(pm.response.code).to.not.eql(403);",
									"});",
									"",
									"console.log('üîê Authentication Test Passed');"
								]
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/vehicles/{{vehicle_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"vehicles",
								"{{vehicle_id}}"
							]
						}
					}
				},
				{
					"name": "4.2 Warranty Registration Summary",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test('Warranty registration flow completed', function () {",
									"    const vehicleId = pm.collectionVariables.get('vehicle_id');",
									"    const customerId = pm.collectionVariables.get('customer_id');",
									"    const vehicleVin = pm.collectionVariables.get('vehicle_vin');",
									"    ",
									"    pm.expect(vehicleId).to.not.be.undefined;",
									"    pm.expect(customerId).to.not.be.undefined;",
									"    pm.expect(vehicleVin).to.not.be.undefined;",
									"    ",
									"    console.log('üéâ WARRANTY REGISTRATION FLOW COMPLETED! üéâ');",
									"    console.log('Vehicle ID:', vehicleId);",
									"    console.log('Customer ID:', customerId);",
									"    console.log('VIN:', vehicleVin);",
									"    console.log('Model:', pm.collectionVariables.get('vehicle_model'));",
									"    console.log('Customer Name:', pm.collectionVariables.get('customer_name'));",
									"    console.log('Registration Date:', pm.collectionVariables.get('registration_date'));",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/vehicles/vin/{{vehicle_vin}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"vehicles",
								"vin",
								"{{vehicle_vin}}"
							]
						}
					}
				}
			]
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "jwt_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "staff_username",
			"value": "",
			"type": "string"
		},
		{
			"key": "staff_email",
			"value": "",
			"type": "string"
		},
		{
			"key": "staff_password",
			"value": "",
			"type": "string"
		},
		{
			"key": "staff_fullname",
			"value": "",
			"type": "string"
		},
		{
			"key": "staff_phone",
			"value": "",
			"type": "string"
		},
		{
			"key": "staff_user_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "customer_phone",
			"value": "",
			"type": "string"
		},
		{
			"key": "customer_name",
			"value": "",
			"type": "string"
		},
		{
			"key": "customer_email",
			"value": "",
			"type": "string"
		},
		{
			"key": "customer_address",
			"value": "",
			"type": "string"
		},
		{
			"key": "customer_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "vehicle_vin",
			"value": "",
			"type": "string"
		},
		{
			"key": "vehicle_model",
			"value": "",
			"type": "string"
		},
		{
			"key": "vehicle_year",
			"value": "",
			"type": "string"
		},
		{
			"key": "vehicle_mileage",
			"value": "",
			"type": "string"
		},
		{
			"key": "vehicle_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "registration_date",
			"value": "",
			"type": "string"
		},
		{
			"key": "warranty_start",
			"value": "",
			"type": "string"
		},
		{
			"key": "installation_datetime",
			"value": "",
			"type": "string"
		},
		{
			"key": "battery_serial",
			"value": "",
			"type": "string"
		},
		{
			"key": "motor_serial",
			"value": "",
			"type": "string"
		},
		{
			"key": "inverter_serial",
			"value": "",
			"type": "string"
		},
		{
			"key": "claim_title",
			"value": "",
			"type": "string"
		},
		{
			"key": "claim_description",
			"value": "",
			"type": "string"
		},
		{
			"key": "appointment_date",
			"value": "",
			"type": "string"
		},
		{
			"key": "diagnostic_summary",
			"value": "",
			"type": "string"
		},
		{
			"key": "diagnostic_data",
			"value": "",
			"type": "string"
		},
		{
			"key": "test_results",
			"value": "",
			"type": "string"
		},
		{
			"key": "repair_notes",
			"value": "",
			"type": "string"
		},
		{
			"key": "labor_hours",
			"value": "",
			"type": "string"
		},
		{
			"key": "intake_claim_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "intake_claim_number",
			"value": "",
			"type": "string"
		},
		{
			"key": "collab_claim_title",
			"value": "",
			"type": "string"
		},
		{
			"key": "collab_claim_description",
			"value": "",
			"type": "string"
		},
		{
			"key": "collab_appointment_date",
			"value": "",
			"type": "string"
		},
		{
			"key": "tech_diagnostic_summary",
			"value": "",
			"type": "string"
		},
		{
			"key": "tech_diagnostic_data",
			"value": "",
			"type": "string"
		},
		{
			"key": "tech_test_results",
			"value": "",
			"type": "string"
		},
		{
			"key": "tech_repair_notes",
			"value": "",
			"type": "string"
		},
		{
			"key": "tech_labor_hours",
			"value": "",
			"type": "string"
		},
		{
			"key": "collab_claim_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "collab_claim_number",
			"value": "",
			"type": "string"
		}
	]
}
