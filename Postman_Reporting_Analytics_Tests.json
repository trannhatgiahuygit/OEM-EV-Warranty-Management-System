{
  "info": {
    "name": "Reporting and Analytics Tests",
    "description": "Test báo cáo và phân tích dữ liệu bảo hành",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Login EVM Staff",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"EVM Staff login successful\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    var token = jsonData.token || jsonData.accessToken;",
              "    pm.collectionVariables.set(\"evm_token\", token);",
              "    pm.collectionVariables.set(\"evm_id\", jsonData.userId || jsonData.id);",
              "    console.log(\"✅ EVM Staff Token saved\");",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"evm_staff1\",\n  \"password\": \"123\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/auth/login",
          "host": ["{{base_url}}"],
          "path": ["api", "auth", "login"]
        }
      }
    },
    {
      "name": "2. Generate Warranty Cost Report",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Generate warranty cost report successful\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.collectionVariables.set(\"report_id\", jsonData.reportId);",
              "    console.log(\"✅ Report ID: \" + jsonData.reportId);",
              "}",
              "",
              "pm.test(\"Report data present\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.executiveSummary).to.exist;",
              "    pm.expect(jsonData.periodBreakdown).to.exist;",
              "    pm.expect(jsonData.categoryBreakdown).to.exist;",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{evm_token}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"reportStartDate\": \"2024-01-01\",\n  \"reportEndDate\": \"2024-12-31\",\n  \"reportType\": \"DETAILED\",\n  \"groupBy\": \"MONTH\",\n  \"vehicleModels\": [\"EV Model X Pro\", \"EV Model Y Standard\"],\n  \"statusCodes\": [\"APPROVED\", \"COMPLETED\", \"CLOSED\"],\n  \"includeZeroCostClaims\": true,\n  \"minCostThreshold\": 0,\n  \"maxCostThreshold\": 100000000,\n  \"includePreviousPeriod\": true,\n  \"comparisonType\": \"YOY\"\n}"
        },
        "url": { "raw": "{{base_url}}/api/evm/reports/warranty-costs/generate", "host": ["{{base_url}}"], "path": ["api","evm","reports","warranty-costs","generate"] }
      }
    },
    {
      "name": "3. Get Quick Summary",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Get quick summary successful\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Summary data present\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.totalWarrantyCost).to.exist;",
              "    pm.expect(jsonData.totalClaims).to.exist;",
              "    pm.expect(jsonData.averageCostPerClaim).to.exist;",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [ { "key": "Authorization", "value": "Bearer {{evm_token}}" } ],
        "url": {
          "raw": "{{base_url}}/api/evm/reports/warranty-costs/quick-summary?startDate=2024-01-01&endDate=2024-12-31",
          "host": ["{{base_url}}"],
          "path": ["api","evm","reports","warranty-costs","quick-summary"],
          "query": [ { "key": "startDate", "value": "2024-01-01" }, { "key": "endDate", "value": "2024-12-31" } ]
        }
      }
    },
    {
      "name": "4. Get Claims by Status",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Get claims by status successful\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Claims data present\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{evm_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/claims/status/PENDING_EVM_APPROVAL",
          "host": ["{{base_url}}"],
          "path": ["api", "claims", "status", "PENDING_EVM_APPROVAL"]
        }
      }
    },
    {
      "name": "5. Get Claims Statistics",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Get claims statistics successful\", function () { pm.response.to.have.status(200); });",
              "const jsonData = pm.response.json();",
              "pm.test('Has status ok', () => pm.expect(jsonData.status).to.exist);",
              "pm.test('Has message', () => pm.expect(jsonData.message).to.exist);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{evm_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/evm/claims/statistics?startDate=2024-01-01&endDate=2024-12-31",
          "host": ["{{base_url}}"],
          "path": ["api", "evm", "claims", "statistics"],
          "query": [
            {
              "key": "startDate",
              "value": "2024-01-01"
            },
            {
              "key": "endDate",
              "value": "2024-12-31"
            }
          ]
        }
      }
    },
    {
      "name": "6. Get Top Expensive Claims",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Get top expensive claims successful\", function () { pm.response.to.have.status(200); });",
              "const jsonData = pm.response.json();",
              "pm.test('Has status ok', () => pm.expect(jsonData.status).to.exist);",
              "pm.test('Has limit', () => pm.expect(jsonData.limit).to.exist);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{evm_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/evm/claims/top-expensive?limit=10&startDate=2024-01-01&endDate=2024-12-31",
          "host": ["{{base_url}}"],
          "path": ["api", "evm", "claims", "top-expensive"],
          "query": [
            {
              "key": "limit",
              "value": "10"
            },
            {
              "key": "startDate",
              "value": "2024-01-01"
            },
            {
              "key": "endDate",
              "value": "2024-12-31"
            }
          ]
        }
      }
    },
    {
      "name": "7. Get Claims by Vehicle Model",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Get claims by vehicle model successful\", function () { pm.response.to.have.status(200); });",
              "const jsonData = pm.response.json();",
              "pm.test('Has status ok', () => pm.expect(jsonData.status).to.exist);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{evm_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/evm/claims/by-vehicle-model?startDate=2024-01-01&endDate=2024-12-31",
          "host": ["{{base_url}}"],
          "path": ["api", "evm", "claims", "by-vehicle-model"],
          "query": [
            {
              "key": "startDate",
              "value": "2024-01-01"
            },
            {
              "key": "endDate",
              "value": "2024-12-31"
            }
          ]
        }
      }
    },
    {
      "name": "8. Get Claims by Region",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Get claims by region successful\", function () { pm.response.to.have.status(200); });",
              "const jsonData = pm.response.json();",
              "pm.test('Has status ok', () => pm.expect(jsonData.status).to.exist);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{evm_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/evm/claims/by-region?startDate=2024-01-01&endDate=2024-12-31",
          "host": ["{{base_url}}"],
          "path": ["api", "evm", "claims", "by-region"],
          "query": [
            {
              "key": "startDate",
              "value": "2024-01-01"
            },
            {
              "key": "endDate",
              "value": "2024-12-31"
            }
          ]
        }
      }
    },
    {
      "name": "9. Get Claims Trend Analysis",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Get claims trend analysis successful\", function () { pm.response.to.have.status(200); });",
              "const jsonData = pm.response.json();",
              "pm.test('Has status ok', () => pm.expect(jsonData.status).to.exist);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{evm_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/evm/claims/trend-analysis?startDate=2024-01-01&endDate=2024-12-31&period=MONTHLY",
          "host": ["{{base_url}}"],
          "path": ["api", "evm", "claims", "trend-analysis"],
          "query": [
            {
              "key": "startDate",
              "value": "2024-01-01"
            },
            {
              "key": "endDate",
              "value": "2024-12-31"
            },
            {
              "key": "period",
              "value": "MONTHLY"
            }
          ]
        }
      }
    },
    {
      "name": "10. Get Technician Performance Report",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Get technician performance report successful\", function () { pm.response.to.have.status(200); });",
              "const jsonData = pm.response.json();",
              "pm.test('Has status ok', () => pm.expect(jsonData.status).to.exist);",
              "pm.test('Has suggestions', () => pm.expect(jsonData.suggestions).to.exist);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{evm_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/evm/technicians/performance?startDate=2024-01-01&endDate=2024-12-31",
          "host": ["{{base_url}}"],
          "path": ["api", "evm", "technicians", "performance"],
          "query": [
            {
              "key": "startDate",
              "value": "2024-01-01"
            },
            {
              "key": "endDate",
              "value": "2024-12-31"
            }
          ]
        }
      }
    },
    {
      "name": "11. Get Parts Failure Statistics",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Get parts failure statistics successful\", function () { pm.response.to.have.status(200); });",
              "const jsonData = pm.response.json();",
              "pm.test('Summary has totalFailures', () => pm.expect(jsonData.totalFailures).to.exist);",
              "pm.test('Summary has totalFailureCost', () => pm.expect(jsonData.totalFailureCost).to.exist);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{evm_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/evm/parts/failure-stats?startDate=2024-01-01&endDate=2024-12-31",
          "host": ["{{base_url}}"],
          "path": ["api", "evm", "parts", "failure-stats"],
          "query": [
            {
              "key": "startDate",
              "value": "2024-01-01"
            },
            {
              "key": "endDate",
              "value": "2024-12-31"
            }
          ]
        }
      }
    },
    {
      "name": "12. Export Report to PDF",
      "event": [
        { "listen": "test", "script": { "exec": [
          "pm.test(\"Export report to PDF successful\", function () { pm.response.to.have.status(200); });",
          "const json = pm.response.json();",
          "pm.test('Export response has reportId', () => pm.expect(json.reportId).to.exist);",
          "pm.test('Export response has message', () => pm.expect(json.message).to.exist);"
        ], "type": "text/javascript" } }
      ],
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{evm_token}}" } ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"reportStartDate\": \"2024-01-01\",\n  \"reportEndDate\": \"2024-12-31\",\n  \"reportType\": \"SUMMARY\",\n  \"groupBy\": \"MONTH\"\n}"
        },
        "url": { "raw": "{{base_url}}/api/evm/reports/warranty-costs/export", "host": ["{{base_url}}"], "path": ["api","evm","reports","warranty-costs","export"] }
      }
    },
    {
      "name": "13. Get Dashboard Summary",
      "event": [
        { "listen": "test", "script": { "exec": [
          "pm.test(\"Get dashboard summary successful\", function () { pm.response.to.have.status(200); });",
          "const jsonData = pm.response.json();",
          "pm.test('Has status ok', () => pm.expect(jsonData.status).to.exist);",
          "pm.test('Has suggestions', () => pm.expect(jsonData.suggestions).to.exist);"
        ], "type": "text/javascript" } }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{evm_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/evm/dashboard/summary",
          "host": ["{{base_url}}"],
          "path": ["api", "evm", "dashboard", "summary"]
        }
      }
    }
  ]
}
